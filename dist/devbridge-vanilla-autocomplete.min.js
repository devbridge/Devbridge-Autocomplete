/**
*  Devbridge Vanilla Autocomplete, version 1.0.0
*  (c) 2015 Tomas Kirda
*
*  Devbridge Vanilla Autocomplete is freely distributable under the terms of an MIT license.
*  For details visit: https://github.com/devbridge/Vanilla-Autocomplete
*/
!function(a){"use strict";function b(a,c){var e=function(){},f=this,g={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,onSearchError:e,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!1,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(a){return"string"==typeof a?JSON.parse(a):a},forceFixPosition:!1,formatGroup:function(a){return'<div class="autocomplete-group"><strong>'+a+"</strong></div>"}};f.element=a,f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse={},f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.options=d.extend({},g,c),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.visible=!1,f.initialize(),f.setOptions(c)}var c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40},d={};d.ajax=function(a,b,c){var e=new XMLHttpRequest,f=a.headers||{},g=a.method||a.type||"GET",h="X-Requested-With",i="GET"===g?a.url+"?"+d.param(a.data):a.url;e.onreadystatechange=function(){4===e.readyState&&(200===e.status?b(e.responseText):c(e))},a.crossDomain||f[h]||(f[h]="XMLHttpRequest"),e.open(g,i,!0);for(var j in f)f.hasOwnProperty(j)&&e.setRequestHeader(j,f[j]);return e.send(null),e},d.ajaxAbort=function(a){a&&a.abort&&a.abort()},d.param=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&").replace(/%20/g,"+")},d.escapeRegExChars=function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},d.createNode=function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b},d.hasClass=function(a,b){var c=(a.className||"").split(" ");return d.inArray(b,c)>-1},d.getData=function(a,b){return a.dataset?a.dataset[b]:a.getAttribute("data-"+b)},d.matchElement=function(a,b,c){for(var e=a.target;e;){if(d.hasClass(e,b))return e;if(e=e.parentNode,!e||e===c)return null}},d.extend=function(a){function b(a,c){var e;for(e in c)if(c.hasOwnProperty(e)){var f=c[e];a.hasOwnProperty(e)&&"object"==typeof a[e]&&d.isPlainObject(f)&&!d.isArray(f)?b(a[e],f):a[e]=f}return a}var c,e=arguments.length;for(c=1;e>c;c++)a=b(a,arguments[c]);return a},d.isArray=function(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},d.inArray=function(a,b){var c,d=-1,e=b.length;for(c=0;e>c;c++)if(a===b[c]){d=c;break}return d},d.toCamelCase=function(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})},d.css=function(a,b){if("string"==typeof b)return window.getComputedStyle(a).getPropertyValue(b);var c,e=a.style;for(c in b)if(b.hasOwnProperty(c)){var f=d.toCamelCase(c),g=b[c];"number"==typeof g&&d.inArray(f,["width","height","top","left","right","bottom"])>-1&&(g+="px"),e[f]=g}},d.isPlainObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},d.isFunction=function(a){return"function"==typeof a},d.noop=function(){},d.each=function(a,b){for(var c=a.length,d=0;c>d;d++)b(a[d],d)},d.removeClass=function(a,b){var c=a.className.split(" "),e=[];d.each(c,function(a){b!==a&&e.push(a)}),a.className=e.join(" ")},d.addClass=function(a,b){a.className=a.className+" "+b},d.show=function(a){a.style.display="block"},d.hide=function(a){a.style.display="none"},d.on=function(a,b,c){a.addEventListener(b,c,!1)},b.utils=d,b.formatResult=function(a,b){var c="("+d.escapeRegExChars(b)+")";return a.value.replace(new RegExp(c,"gi"),"<strong>$1</strong>")},b.prototype={initialize:function(){function a(a){return function(b){a.call(c,b)}}var b,c=this,e=c.classes.selected,f=c.options,g=c.element;g.setAttribute("autocomplete","off"),c.killerFn=function(){c.killSuggestions(),c.disableKillerFn()},c.suggestionsContainer=d.createNode(f.containerClass),b=c.suggestionsContainer,f.appendTo.appendChild(b),"auto"!==f.width&&d.css(c.suggestionsContainer,{width:f.width}),d.on(b,"mouseover",function(a){var e=d.matchElement(a,c.classes.suggestion,b);e&&c.activate(d.getData(e,"index"))}),d.on(b,"mouseout",function(){c.selectedIndex=-1;var a=b.getElementsByClassName(e);d.each(a,function(a){d.removeClass(a,e)})}),d.on(b,"click",function(a){var e=d.matchElement(a,c.classes.suggestion,b);e&&(c.select(d.getData(e,"index")),a.stopPropagation())}),c.fixPositionCapture=function(){c.visible&&c.fixPosition()},d.on(window,"resize",c.fixPositionCapture),d.on(g,"keydown",a(c.onKeyDown)),d.on(g,"keyup",a(c.onKeyUp)),d.on(g,"change",a(c.onKeyUp)),d.on(g,"blur",a(c.onBlur)),d.on(g,"focus",a(c.onFocus))},onFocus:function(){var a=this;a.options.minChars<=a.element.value.length&&a.onValueChange(),a.fixPosition()},onBlur:function(){this.enableKillerFn()},setOptions:function(a){var b=this,c=b.options;d.extend(c,a),b.isLocal=d.isArray(c.lookup),b.isLocal&&(c.lookup=b.verifySuggestionsFormat(c.lookup)),d.css(b.suggestionsContainer,{"max-height":c.maxHeight+"px",width:c.width+"px","z-index":c.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,clearInterval(a.onChangeInterval),a.currentRequest&&(d.ajaxAbort(a.currentRequest),a.currentRequest=null)},enable:function(){this.disabled=!1},fixPosition:function(){var a=this,b=a.suggestionsContainer,c=b.parentNode;if(c===document.body){var e=a.element.offsetHeight,f={top:a.element.offsetTop,left:a.element.offsetLeft},g={top:f.top+e,left:f.left};"auto"===a.options.width&&(g.width=a.element.offsetWidth-2+"px"),d.css(b,g)}},enableKillerFn:function(){var a=this;document.addEventListener("click",a.killerFn)},disableKillerFn:function(){var a=this;document.removeEventListener("click",a.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a,b=this,c=b.element.value.length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyDown:function(a){var b=this;if(!b.disabled&&!b.visible&&a.which===c.DOWN&&b.currentValue)return void b.suggest();if(!b.disabled&&b.visible){switch(a.which){case c.ESC:b.element.value=b.currentValue,b.hide();break;case c.RIGHT:if(b.hint&&b.options.onHint&&b.isCursorAtEnd()){b.selectHint();break}return;case c.TAB:if(b.hint&&b.options.onHint)return void b.selectHint();if(-1===b.selectedIndex)return void b.hide();if(b.select(b.selectedIndex),b.options.tabDisabled===!1)return;break;case c.RETURN:if(-1===b.selectedIndex)return void b.hide();b.select(b.selectedIndex);break;case c.UP:b.moveUp();break;case c.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case c.UP:case c.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.element.value&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},changeValue:function(a){var b=this;b.element.value=a,b.onValueChange()},onValueChange:function(){var a,b=this,c=b.options,e=b.element.value,f=b.getQuery(e);return b.selection&&b.currentValue!==f&&(b.selection=null,(c.onInvalidateSelection||d.noop).call(b.element)),clearInterval(b.onChangeInterval),b.currentValue=e,b.selectedIndex=-1,c.triggerSelectOnValidInput&&(a=b.findSuggestionIndex(f),-1!==a)?void b.select(a):void(f.length<c.minChars?b.hide():b.getSuggestions(f))},findSuggestionIndex:function(a){var b=this,c=-1,d=a.toLowerCase();return b.suggestions.forEach(function(a,b){return a.value.toLowerCase()===d?(c=b,!1):void 0}),c},getQuery:function(a){var b,c=this.options.delimiter;return c?(b=a.split(c),b[b.length-1].trim()):a},getSuggestionsLocal:function(a){var b,c=this,d=c.options,e=a.toLowerCase(),f=d.lookupFilter,g=parseInt(d.lookupLimit,10);return b={suggestions:d.lookup.filter(function(b){return f(b,a,e)})},g&&b.suggestions.length>g&&(b.suggestions=b.suggestions.slice(0,g)),b},getSuggestions:function(a){var b,c,e,f,g=this,h=g.options,i=h.serviceUrl;if(h.params[h.paramName]=a,c=h.ignoreParams?null:h.params,h.onSearchStart.call(g.element,h.params)!==!1){if(d.isFunction(h.lookup))return void h.lookup(a,function(b){g.suggestions=b.suggestions,g.suggest(),h.onSearchComplete.call(g.element,a,b.suggestions)});g.isLocal?b=g.getSuggestionsLocal(a):(d.isFunction(i)&&(i=i.call(g.element,a)),e=i+"?"+d.param(c||{}),b=g.cachedResponse[e]),b&&d.isArray(b.suggestions)?(g.suggestions=b.suggestions,g.suggest(),h.onSearchComplete.call(g.element,a,b.suggestions)):g.isBadQuery(a)?h.onSearchComplete.call(g.element,a,[]):(g.currentRequest&&(d.ajaxAbort(g.currentRequest),g.currentRequest=null),f={url:i,data:c,type:h.type,dataType:h.dataType},d.extend(f,h.ajaxSettings),g.currentRequest=d.ajax(f,function(b){g.currentRequest=null;var c=h.transformResult(b);g.processResponse(c,a,e),h.onSearchComplete.call(g.element,a,c.suggestions)},function(b){h.onSearchError.call(g.element,a,b)}))}},isBadQuery:function(a){var b=this,c=b.badQueries,d=c.length;if(!b.options.preventBadQueries)return!1;for(;d--;)if(0===a.indexOf(c[d]))return!0;return!1},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,clearInterval(a.onChangeInterval),d.hide(a.suggestionsContainer),a.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var a,b,c=this,e=c.options,f=e.groupBy,g=e.formatResult,h=c.getQuery(c.currentValue),i=c.classes.suggestion,j=c.classes.selected,k=c.suggestionsContainer,l=e.beforeRender,m="",n=function(b){var c=b.data[f];return a===c?"":(a=c,e.formatGroup(a))};return e.triggerSelectOnValidInput&&(b=c.findSuggestionIndex(h),-1!==b)?void c.select(b):(c.suggestions.forEach(function(a,b){f&&(m+=n(a,h,b)),m+='<div class="'+i+'" data-index="'+b+'">'+g(a,h)+"</div>"}),this.adjustContainerWidth(),k.innerHTML=m,d.isFunction(l)&&l.call(c.element,k),c.fixPosition(),d.show(k),e.autoSelectFirst&&(c.selectedIndex=0,k.scrollTop=0,d.addClass(k.firstChild,j)),c.visible=!0,void c.findBestHint())},adjustContainerWidth:function(){var a,b=this,c=b.options,d=b.suggestionsContainer;"auto"===c.width&&(a=b.element.offsetWidth-2,d.style.width=(a>0?a:300)+"px")},findBestHint:function(){var a=this,b=a.element.value.toLowerCase(),c=null;b&&(a.suggestions.every(function(a){var d=0===a.value.toLowerCase().indexOf(b);return d&&(c=a),!d}),a.signalHint(c))},signalHint:function(a){var b="",c=this;a&&(b=c.currentValue+a.value.substr(c.currentValue.length)),c.hintValue!==b&&(c.hintValue=b,c.hint=a,(this.options.onHint||d.noop)(b))},verifySuggestionsFormat:function(a){return a.length&&"string"==typeof a[0]?a.map(function(a){return{value:a,data:null}}):a},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(a){"number"!=typeof a&&(a=parseInt(a,10));var b=this,c=b.classes.selected,e=b.suggestionsContainer,f=e.getElementsByClassName(b.classes.suggestion),g=f[a];return d.each(e.getElementsByClassName(c),function(a){d.removeClass(a,c)}),b.selectedIndex=a,d.addClass(g,c),g},selectHint:function(){var a=this,b=d.inArray(a.hint,a.suggestions);a.select(b)},select:function(a){var b=this;b.hide(),b.onSelect(a)},moveUp:function(){var a=this;if(-1!==a.selectedIndex)return 0===a.selectedIndex?(d.removeClass(a.suggestionsContainer.children[0],a.classes.selected),a.selectedIndex=-1,a.element.value=a.currentValue,void a.findBestHint()):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b=this,c=b.activate(a),d=c.offsetTop,e=b.suggestionsContainer.scrollTop,f=c.offsetHeight,g=e+b.options.maxHeight-f;e>d?b.suggestionsContainer.scrollTop=d:d>g&&(b.suggestionsContainer.scrollTop=d-b.options.maxHeight+f),b.element.value=b.getValue(b.suggestions[a].value),b.signalHint(null)},onSelect:function(a){var b=this,c=b.options.onSelect,e=b.suggestions[a];b.currentValue=b.getValue(e.value),b.currentValue!==b.element.value&&(b.element.value=b.currentValue),b.signalHint(null),b.suggestions=[],b.selection=e,d.isFunction(c)&&c.call(b.element,e)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var a=this,b=a.suggestionsContainer;a.disableKillerFn(),b.parentNode&&b.parentNode.removeChild(b)}},"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define(function(){return b}),a.VanillaAutocomplete=b}(this);